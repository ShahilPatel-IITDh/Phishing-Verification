(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{392:function(e,t,a){a(543),a(570)(SYS_CONST,(function(){switch(SYS_CONST.page){default:a(747);break;case'login':a(749)}}))},571:function(e,t,a){var o=a(475),n=a(396);a(426);e.exports={blurBgImg:function(){var e=o.DATA,t=o.backgroundurl("./login.b0127.js"),i=o.favorurl("./login.b0127.js");function r(e,t){var a='';return n.isEmptyObject(t)?a:(a+=e+'{',n.each(t,(function(e,t){t&&(a+=e+':'+t+';')})),a+='}')}if(o.customized&&(function(e){var a='';a+=r('label.slogan',{color:e.facade_custom.slogan_color,'font-size':e.facade_custom.slogan_fontsize?e.facade_custom.slogan_fontsize+'px':''}),a+=r('div.main-bottom',{'background-color':e.facade_custom.background_color}),t&&(a+=r('div.main-bottom',{'background-image':'url("./t")',filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+t+'", sizingMethod="scale")'}));a+=r('.u-form button.u-btn',{'background-color':e.facade_custom.submit_button_color,color:e.facade_custom.submit_button_font_color}),n('#dHead').append(n('<style type="text/css">'+a+'</style>'))}(e),function(e){e.facade_custom.favor_title&&(document.title=e.facade_custom.favor_title);if(i){var t=document.createElement('link');t.type='image/x-icon',t.rel='shortcut icon',t.href=i,document.getElementsByTagName('head')[0].appendChild(t)}}(e)),!t){var c=Math.round(3*Math.random());n('.main-bottom').addClass('main-bottom-'+c),n('.main-middle').addClass('main-middle-'+c)}/MSIE ([67])/i.test(navigator.userAgent)||setTimeout((function(){!function(e,t){var o=n(e);t.cacheExpired=t.cacheExpired||Number.MAX_VALUE;var i=(new Date).getTime(),r=document.createElement('canvas'),c=!1;if(e=e.replace(/[^a-zA-Z0-9]/g,''),!r.getContext||!('Worker'in window))return;t=n.extend({source:'body',radius:5,overlay:'',offset:{x:0,y:0},optClass:'',cache:!1,cacheKeyPrefix:'blurjs-',draggable:!1,debug:!1},t),o.each((function(){var o,s=n(this),l=n(t.source),d=l.css('backgroundImage').replace(/"/g,'').replace(/url\(|\)$/gi,''),u=r.getContext('2d'),h=new Image;h.onload=function(){function g(e){var a=l.css('backgroundAttachment'),o='fixed'===a?'':'-'+(s.offset().left-l.offset().left-t.offset.x)+'px -'+(s.offset().top-l.offset().top-t.offset.y)+'px';s.css({'background-image':'url("./e")','background-repeat':l.css('backgroundRepeat'),'background-position':o,'background-attachment':a}),!1!==t.optClass&&s.addClass(t.optClass),t.draggable&&(s.css({'background-attachment':'fixed','background-position':'0 0'}),s.draggable())}c?g(h.src):(r.style.display='none',r.width=h.width,r.height=h.height,u.drawImage(h,0,0),function(e,t,o,i,r,c){var s=n.Deferred(),l=a(748)();if(isNaN(c)||c<1)return;c|=0;var d,u=e.getContext('2d');try{try{d=u.getImageData(t,o,i,r)}catch(h){try{netscape.security.PrivilegeManager.enablePrivilege('UniversalBrowserRead'),d=u.getImageData(t,o,i,r)}catch(h){throw alert('Cannot access local image'),new Error('unable to access local image data: '+h)}}}catch(h){throw alert('Cannot access image'),new Error('unable to access image data: '+h)}return l.onmessage=function(e){var a=e.data;if('afterCal'===a.type)return u.putImageData(a.j,t,o),s.resolve()},l.postMessage({type:'cal',d:i,j:d,g:c,f:r}),s.promise()}(r,0,0,r.width,r.height,t.radius).then((function(){t.overlay&&(u.beginPath(),u.rect(0,0,h.width,h.width),u.fillStyle=t.overlay,u.fill());var a=r.toDataurl("./login.b0127.js");if(t.cache)try{t.debug&&console.log('Cache Set'),localStorage.setItem(t.cacheKeyPrefix+e+'-'+d+'-data-image',a),o=localStorage.setItem(t.cacheKeyPrefix+e+'-'+d+'-data-image-cacheAt',i)}catch(n){console.log(n)}g(a)})))},Storage.prototype.cacheChecksum=function(a){var o='';for(var n in a){var i=a[n];'[object Object]'===i.toString()?o+=(i.x.toString()+i.y.toString()+',').replace(/[^a-zA-Z0-9]/g,''):o+=(i+',').replace(/[^a-zA-Z0-9]/g,'')}this.getItem(t.cacheKeyPrefix+e+'-'+d+'-options-cache')!==o&&(this.removeItem(t.cacheKeyPrefix+e+'-'+d+'-options-cache'),this.setItem(t.cacheKeyPrefix+e+'-'+d+'-options-cache',o),t.debug&&console.log('Settings Changed, Cache Emptied'))};var g=null;if(t.cache){localStorage.cacheChecksum(t),o=localStorage.getItem(t.cacheKeyPrefix+e+'-'+d+'-data-image-cacheAt');var m=parseInt(i)-parseInt(o);m>0&&m<t.cacheExpired&&(g=localStorage.getItem(t.cacheKeyPrefix+e+'-'+d+'-data-image'))}null!=g?(t.debug&&console.log('Cache Used'),c=!0,h.src=g):(t.debug&&console.log('Source Used'),h.src=d)}))}('.aside-blur',{source:'.main-bottom',radius:5,cacheExpired:3e4,cache:!1})}),500)}}},747:function(e,t,a){(function(e,t,o){var n=a(571),i=a(475),r=a(512),c=a(572),s=a(487),l=a(435),d=a(405).alert;a(573);var u=a(444),h=SYS_CONST.secondAuthMeta,g=h.sms||h.dynamic1||h.dynamic2,m=!('none'===h.config||'custom'===h.config),f=SYS_CONST.supportAuthorizedDevice,p=a(418).LE7,v=p,b={expires:30,path:'/'};SYS_CONST.imgCDN&&e('body').addClass('cdn'),n.blurBgImg(),function(){var t=i.DATA,o={partials:{logoTpl:e('#logoTpl').html()}},n=r.compile(e('#contentTpl').html())(t,o);e('.main .content').html(n);var c=r.compile(e('#asideTpl').html())(t,o);e('.main .aside').html(c),g&&a(514)({back:M})}();var w,C,_,y,S,k=a(456),x=k.CC.sid(),T=k.$,I=T(),j=T('input[name=loginType]'),U=a(574)(j),A=a(513),D=A.collectLoginDeviceInfo,E=A.loginDeviceToTrust;function P(){if((g||m)&&p)return N(t('login/login_warn_low_version_second_auth'))}function N(e){return d(e,{confirmTpl:t('login/login_warn_confirm')})}function O(e){if(!P()){var a=k.action(e),o=!1,n=T('#face'),i=n.val();'auto'===i&&(i=v?'XT3':l.get('face')||'auto'),'XT5'===i&&v&&(N(t('login/login_warn_low_version')).then(a),o=!0,i='XT3'),n.val(i),l.set('face',i,b);var r=T('#locale');r.length>0&&l.set('locale',r.val(),b),k.formatUid();var c=T('#saveUsername').not(':hidden');if(c.is(':checked')||f){l.set('saveUsername',!0,b),l.set('uid',k.getFullUid(),b);var s=T('#domain');s.length>0&&l.set('domain',s.val(),b)}else c[0]&&(l.remove('saveUsername',{path:'/'}),l.remove('uid',{path:'/'}));!o&&a()}}function F(){var e;T('#uid').is(':hidden')?T('#uid, #password, #domain').prop('disabled',!0):(k.formatUid(),e=k.getFullUid()),f&&D(e),U.submit()||I.submit()}function M(){T('[name="action:login"]').remove(),I.submit()}function z(t){if(!t)return!1;e('.j-qr-code-login').attr('curstatus',(function(a,o){return(o=o||'')!==t?(e(this).toggleClass(o+' '+t),t):o}))}function L(){return[location.protocol,'//',location.host,'/coremail/'].join('')}w=e('.loginArea'),C='normalForm',w.on('click','[role="dropdown"]',(function(t){var a=e(this).find('.u-menu');a.hasClass('u-menu-show')||e('.u-menu').removeClass('u-menu-show').addClass('u-menu-hidden'),a.toggleClass('u-menu-hidden u-menu-show'),t.stopPropagation()})).on('click','a[logintype]',(function(){var t,n,i=C,r=e(this).attr('logintype');e('.j-qr-code-return').attr('logintype',C),r!==C&&(location.hash='normalForm'===r?'':'#'+r,j.val('normalForm'===r?'':r),w.toggleClass(i+' '+r),C=r,'QRCode'===r?(0===(n=e('.QRCodeImage .wrapper')).children().length&&new c(n[0],{text:(t=x,[L(),'qr/',t].join('')),width:100,height:100,colorDark:'#000000',colorLight:'#ffffff',correctLevel:c.CorrectLevel.H}),function(){var t='onstat/mail/$sid$/op_app_qrcode_login'.replace('$sid$',x),n=e('.QRCodeImage'),i=n.data('poll');function r(t){var a,o,n,r,c,s=t.payload||{};z(s.status),'appVerify'===s.status&&(n=s.avatar,r=s.gender,c='assets/b8f77813/images/'+('0'===(r=r||'0')?'man.png':'woman.png'),e('.headImage img').attr('src',n||c),a=s.trueName,o=s.email,e('.headImageArea .loggedUsername').html(a||o)),'final'===s.status&&(i&&i.unSubscribe(),WsStore&&WsStore.unSubscribe(),setTimeout((function(){var e,t;location.href=(e=s.sid,t=s.cookiecheck,[L(),'XT5/index.jsp?sid=',e,'&Cookie.Coremail=',t].join(''))}),500))}i||(i=new s({topic:o.path('getProcessStatus.jsp?sid='+x),successCallback:r,errorCallback:function(e){'FA_INVALID_SESSION'===(e=e||{}).code&&z('loginFail')}}).subscribe(),window.WebSocket&&WsStore.subscribe(t,(function(e){i&&i.unSubscribe(),r(e)}),{io:a(494),host:SYS_CONST.wsConfig.host,authMeta:{sid:x,TmpSes:1,ClientId:'webmail:'+x}}),n.data('poll',i))}()):'QRCode'!==i&&U.toggle(x))})).on('click','.backToScan',(function(){z('waitScan')})).on('click','.headImage i',(function(){location.reload()})),e('.u-menu').on('click','li',(function(t){var a=e(this).closest('[role="dropdown"]');a.find('li .iconfont').remove(),e(this).addClass('u-menu-choose').append('<i class="iconfont iconchoose left"></i>'),a.hasClass('locale')?(e('#locale').val(e(this).data('locale')),l.set('locale',e(this).data('locale'),b),M()):a.hasClass('faceMenu')?(T('.faceTxt').html(e(this).data('facetxt')),T('#faceName').val(e(this).data('facetxt')),T('#face').val(e(this).data('face'))):a.hasClass('domainMenu')&&(T('.domainTxt').html(e(this).data('domain')),T('#domain').val(e(this).data('domain'))),e(this).closest('.u-menu').removeClass('u-menu-show').addClass('u-menu-hidden'),t.stopPropagation()})),e('[data-operation]').on('click',(function(){switch(e(this).data('operation')){case'addFavourite':try{window.external.AddFavorite(location.href,document.title),e(this).addClass('favourite')}catch(u){try{window.sidebar.addPanel(location.href,document.title,''),e(this).addClass('favourite')}catch(u){d(e(this).data('msg'))}}break;case'recoverPwdUrl':var t=e(this).attr('href'),a=T('#uid').val();if(a){var o=t.indexOf('?');if(-1!==o){var n,i,r=t.substr(0,o),c=t.substr(o+1).split('&'),s='';for(n=0;n<c.length;n++)if(-1!==(i=c[n]).indexOf('uid')){var l=i.split('=');l[1]=a,s+=l[0]+'='+l[1]+'&'}else s+=i+'&';s=s.substr(0,s.length-1),e(this).attr('href',r+'?'+s)}else t+='?uid='+a,e(this).attr('href',t)}}})),e('.j-ssl-login-button').on('click',(function(){var e=I.attr('action');location.href='https://'+location.hostname+(80!==location.port?':'+location.port:'')+e.replace(/index.jsp.*/,'index_ca.jsp')})),k.init(O.bind(null,F)),setTimeout(e.fn.click.bind((_='a',y='logintype',S=j.val()||location.hash.substr(1),e(_+'['+y+']').filter((function(){return S===e(this).attr(y)}))))),j.val(''),e.ajax({type:'GET',url:'/coremail/XT5/jsp/mail.jsp',data:{func:'getWeather'},dataType:'json',success:function(t){if('S_OK'===t.code)if('success'===t['var'].weather.status){var a,o=t['var'].weather.results[0],n=o.currentCity,i=o.weather_data[0],r=i.temperature,c=i.dayPictureUrl,s=i.nightPictureUrl;e('#weatherInfo').html(r+' | '+n),a=(new Date).getHours()>=18?s.substring(s.lastIndexOf('/')+1,s.lastIndexOf('.')):c.substring(c.lastIndexOf('/')+1,c.lastIndexOf('.')),e('#weatherPic').addClass('icon'+a),e('#weather').show()}else e('#weather').hide()},error:function(){}}),function(){var e=l.get('domain')||'',t=l.get('uid')||'';e.length>0&&(T('[data-domain="'+e+'"]').trigger('click'),t=t.split('@')[0]);t.length>0&&T('#uid').val(t);var a=l.get('saveUsername')||'';T('#saveUsername').length&&T('#saveUsername').prop('checked','true'===a);var o=l.get('face')||'';o.length>0&&T('[data-face="'+o+'"]').trigger('click');u.loadPassword(T('#fakePassword'))}(),P(),p||'FA_NEED_BIND_DEVICE'!==SYS_CONST.loginResultCode||E().truthy().then((function(){T('.j-authorizeDevice').val(!0),T('#uid').hide(),O(F)})),e(document).customRadioCheckbox()}).call(this,a(396),a(397),a(411))},748:function(e,t,a){e.exports=function(){return new Worker(a.p+'836f04dccee11a9c3312.worker.js')}},749:function(e,t,a){(function(e,t){a(571);var o,n,i=a(475),r=a(512),c=a(435),s=a(444),l={expires:30,path:'/'};!function(){var a=i.facadeCustom;e('head').append('<link id="favor" rel="shortcut icon" />'),document.title=a.favor_title||v('login_main_title',document.title);var o=i.favorurl("./login.b0127.js");o&&e('#favor').attr('href',o);var n=a.logo_link||'http://www.coremail.cn',r=i.logourl("./login.b0127.js")||v('login_logo_path','common/assets/index_cmxt50/img/logo.png');r?e('.j-logo').show().find('a').attr('href',n).find('img').attr('src',r):e('.j-logo').remove();var c=a.copyright_text||v('login_copyright',t('main/copyright'));c&&a.copyright_link?e('.j-copyright').html('<a target="_blank">').find('a').attr('href',a.copyright_link).html(c):c?e('.j-copyright').html('<label>').html(c):e('.j-copyright').remove()}(),o=i.DATA,n=r.compile(e('#loginFormTpl').html())(o),e('.main').html(n),a(514)();var d=a(456),u=a(513),h=u.collectLoginDeviceInfo,g=u.loginDeviceToTrust,m=d.$,f=m(),p=m('.j-need-trans-login');function v(e,a){var o=t('login/'+e,{defaultValue:a});return'DEFAULT'===o?a:o}function b(e){var t=d.action(e),a=m('#face'),o=a.val();'auto'===o&&(o=c.get('face')||'XT5'),'XT5'===o&&/MSIE ([67])/i.test(navigator.userAgent)&&(o='XT3'),a.val(o),c.set('face',o,l);var n=m('#locale');if(n.length>0&&c.set('locale',n.val(),l),d.formatUid(),m('#saveUsername').prop('checked')){c.set('saveUsername',!0,l),c.set('uid',d.getFullUid(),l);var i=m('#domain');i.length>0&&c.set('domain',i.val(),l)}else c.remove('saveUsername',{path:'/'}),c.remove('uid',{path:'/'});t()}function w(){d.formatUid();var e=d.getFullUid();SYS_CONST.supportAuthorizedDevice&&h(e),f.submit()}d.init(b.bind(null,w)),s.loadPassword(m('#fakePassword')),'FA_NEED_BIND_DEVICE'===SYS_CONST.loginResultCode?m('[name=toAdmin]').val()&&!m('.j-try-collect').val()?b(w):(g().truthy().then((function(){m('.j-authorizeDevice').val(!0),b(w)})),e('.j-container').show()):p.val()?(b(w),p.val('')):e('.j-container').show(),e(document).customRadioCheckbox()}).call(this,a(396),a(397))}}]);
//# sourceMappingURL=login.b0127.js.map